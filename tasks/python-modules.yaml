---
- name: Check if pip3 is installed
  ansible.builtin.stat: 
    path: /usr/bin/pip3
  register: pip3

- name: Make sure pip is installed
  ansible.builtin.package:
    name: "{{ python_pip_name }}"
    state: present
  when:
    - (ansible_distribution == 'CentOS' or ansible_distribution == 'RedHat') and ansible_distribution_major_version == '8' or ansible_distribution == 'Ubuntu' or ansible_distribution == 'Fedora' and not pip3.stat.exists
  tags: install

- name: Legacy - make sure pip is installed
  shell: "yum -y install {{ python_pip_name }}"
  when:
    - (ansible_distribution == 'CentOS' or ansible_distribution == 'RedHat') and ansible_distribution_major_version == '7' and not pip3.stat.exists
  tags: install

- name: Legacy -Make sure pip is upgraded to latest version
  shell: |
    pip{{ 3 if pip3.stat.exists|bool or ansible_distribution == 'Ubuntu' else '2' }} install pip --upgrade pip
  when:
    - (ansible_distribution == 'CentOS' or ansible_distribution == 'RedHat') and ansible_distribution_major_version == '7' and not pip3.stat.exists
  tags: install
  
- name: Install python modules
  ansible.builtin.pip:
    name: "{{ item.name }}"
    version: "{{ item.version | default(omit) }}"
    executable: "pip{{ 3 if pip3.stat.exists|bool or ansible_distribution == 'Ubuntu' else '2' }}"
    state: "{{ state }}"
  loop: "{{ python_modules }}"
  tags: install
  when: python_modules is defined
