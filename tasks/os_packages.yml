---
- name: update all packages
  package:
    name: '*'
    state: latest
  tags: update
  when: update_packages | bool

- name: update apt-get repo and cache
  tags: update
  apt:
    upgrade: dist
  when: update_packages | bool and ansible_distribution == 'Debian'

- name: "install os package"
  package: 
    name: "{{ item.name }}"
    state: present
  loop: "{{ lookup('os_packages', single_key_dict, wantlist=True) }}"
  tags: install
  when: os_packages is defined